#N canvas 1349 113 543 747 12;
#X obj 14 12 cnv 19 500 45 empty empty WitMotion\ BWT901CL\ Decoder# 3 12 0 18 #606060 #ffffff 0;
#X text 398 39 Peter Venus 2023;
#X obj 13 333 cnv 19 500 150 empty empty recieve\ messages\ from\ sensor/\ create\ list\ from\ every\ new\ message 2 12 0 12 #e0e0e0 #404040 0;
#X obj 44 435 spigot 0;
#X obj 44 397 tgl 19 0 empty empty print\ incoming\ msg 0 -10 0 12 #faff00 #000000 #000000 0 1;
#N canvas 235 143 552 638 tester 0;
#X obj 20 94 inlet;
#X obj 20 560 outlet;
#X msg 20 133 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 124 255 237 0 70 139 154 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139 153 85 83 151 255 20 0 113 162 248 71 164 85 89 127 52 123 255 237 0 70 139;
#X obj 20 536 drip 100;
#X text 19 53 This subpatch simulates a stream of data received by the sensor \;;
#X connect 0 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 1 0;
#X restore 310 399 pd tester with zexy/drip;
#X obj 44 459 print COM;
#X obj 310 373 bng 19 250 50 0 empty empty message\ tester 25 12 0 12 #ff8300 #000000 #000000;
#X obj 13 648 cnv 19 500 75 empty empty retreive\ angles 2 12 0 12 #c6ffc7 #404040 0;
#X obj 147 689 bng 20 250 50 0 empty empty RESET\ ANGLE 22 10 0 12 #00ff04 #000000 #000000;
#X text 12 66 This Patch documents a possible solution to decode the messages sent from a WItMotion BWT901 Bluetooth 9-DOF sensor \; Settings to the sensor like Baudrate and type of transmitted messages have to be done (so far) with the MiniMU software provided by WitMotion \; This patch is specifically made to communicate with the SceneRotator-plugin of the IEM Plugin Suite \; [which can be found at plugins.iem.at] At the time of writing sensor documentation can be found at https://www.wit-motion.com/9-axis/wt901blecl-mpu9250-high-precision.html;
#X obj 13 491 cnv 19 500 150 empty empty Comport\ settings:\ select\ correct\ comport\ with\ radio 2 12 0 12 #ffe3c6 #404040 0;
#X msg 30 589 devices;
#X msg 180 589 baud 115200;
#X msg 100 589 open \$1;
#X obj 100 534 hradio 19 1 0 8 empty empty select\ comport\ number 0 -10 0 12 #ffffff #000000 #000000 0;
#X obj 30 534 loadbang;
#X obj 100 558 t b f;
#X obj 187 371 receive \$0-com;
#X obj 30 615 send \$0-com;
#N canvas 866 81 898 554 angle 0;
#X obj 44 145 list length;
#X obj 44 120 t l l;
#X obj 44 169 == 9;
#X obj 44 227 list;
#X obj 44 193 sel 1;
#X msg 345 275 \$5 \$6;
#X obj 345 324 / 32768;
#X obj 194 324 / 32768;
#X msg 194 275 \$3 \$4;
#X obj 345 300 expr (($f2<<8)|$f1);
#X obj 194 300 expr (($f2<<8)|$f1);
#X obj 44 324 / 32768;
#X obj 44 300 expr (($f2<<8)|$f1);
#X msg 44 275 \$1 \$2;
#X obj 44 348 * 180;
#X obj 194 348 * 180;
#X obj 345 348 * 180;
#X text 92 166 as new msg need to "build up" from a single element to their full length (9 in this case) \, the full msg will only be forwarded \, if length == 9 is true;
#X obj 509 300 cnv 19 360 20 empty empty expr-calculations\ according\ to\ sensor\ documentation 2 12 0 12 #ffe3c6 #000000 0;
#X text 148 226 the first 6 elements of the list carry the necessary information to retreive the angles;
#X obj 44 93 r \$0-angle;
#X floatatom 496 445 5 0 0 3 YAW/Z - - 0;
#X floatatom 270 445 5 0 0 3 Pitch/Y - - 0;
#X floatatom 44 445 5 0 0 3 Roll/X - - 0;
#N canvas 571 377 999 311 reset 0;
#X obj 38 42 inlet;
#X obj 238 44 inlet;
#X obj 463 43 inlet;
#X obj 511 117 f;
#X obj 468 90 t f f;
#X obj 468 141 - 0;
#X obj 468 212 wrap;
#X obj 468 188 / 360;
#X obj 468 290 outlet;
#X obj 281 117 f;
#X obj 238 90 t f f;
#X obj 238 141 - 0;
#X obj 238 212 wrap;
#X obj 238 188 / 360;
#X obj 238 290 outlet;
#X obj 81 117 f;
#X obj 38 90 t f f;
#X obj 38 141 - 0;
#X obj 38 212 wrap;
#X obj 38 188 / 360;
#X obj 38 290 outlet;
#X obj 238 164 - 180;
#X obj 564 43 inlet reset;
#X obj 38 266 + 180;
#X obj 38 164 - 180;
#X obj 468 164 - 180;
#X obj 468 236 * -360;
#X obj 468 266 + 180;
#X obj 238 236 * -360;
#X obj 38 236 * -360;
#X obj 238 266 + 180;
#X connect 0 0 16 0;
#X connect 1 0 10 0;
#X connect 2 0 4 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 4 1 3 1;
#X connect 5 0 25 0;
#X connect 6 0 26 0;
#X connect 7 0 6 0;
#X connect 9 0 11 1;
#X connect 10 0 11 0;
#X connect 10 1 9 1;
#X connect 11 0 21 0;
#X connect 12 0 28 0;
#X connect 13 0 12 0;
#X connect 15 0 17 1;
#X connect 16 0 17 0;
#X connect 16 1 15 1;
#X connect 17 0 24 0;
#X connect 18 0 29 0;
#X connect 19 0 18 0;
#X connect 21 0 13 0;
#X connect 22 0 3 0;
#X connect 22 0 9 0;
#X connect 22 0 15 0;
#X connect 23 0 20 0;
#X connect 24 0 19 0;
#X connect 25 0 7 0;
#X connect 26 0 27 0;
#X connect 27 0 8 0;
#X connect 28 0 30 0;
#X connect 29 0 23 0;
#X connect 30 0 14 0;
#X restore 44 396 pd reset axis mechanism subpatch;
#X f 65;
#X obj 90 444 outlet Roll;
#X obj 317 445 outlet Pitch;
#X obj 544 445 outlet YAW;
#X obj 496 348 inlet reset;
#X text 43 24 ######################################################## \; This subpatch creates the euler angles from the received HEX-Bytes \; ######################################################## \;;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X connect 1 1 3 1;
#X connect 2 0 4 0;
#X connect 3 0 5 0;
#X connect 3 0 8 0;
#X connect 3 0 13 0;
#X connect 4 0 3 0;
#X connect 5 0 9 0;
#X connect 6 0 16 0;
#X connect 7 0 15 0;
#X connect 8 0 10 0;
#X connect 9 0 6 0;
#X connect 10 0 7 0;
#X connect 11 0 14 0;
#X connect 12 0 11 0;
#X connect 13 0 12 0;
#X connect 14 0 24 0;
#X connect 15 0 24 1;
#X connect 16 0 24 2;
#X connect 20 0 1 0;
#X connect 24 0 23 0;
#X connect 24 0 25 0;
#X connect 24 1 22 0;
#X connect 24 1 26 0;
#X connect 24 2 21 0;
#X connect 24 2 27 0;
#X connect 28 0 24 3;
#X restore 260 656 pd angle conversion subpatch;
#X obj 187 400 comport 6 115200;
#X text 13 242 This Patch requires the following libraries to be installed via DEKEN \; - comport \; - zexy;
#X floatatom 260 691 5 0 0 3 Pitch - - 0;
#X floatatom 356 691 5 0 0 3 Roll - - 0;
#X floatatom 453 692 5 0 0 3 Yaw - - 0;
#N canvas 745 462 662 300 build 0;
#X obj 17 69 sel 85;
#X obj 56 125 list prepend;
#X obj 196 154 t l;
#X text 196 118 create lists from stream of numbers until "85" starts new msg \;;
#X text 74 70 "85" starts new line/every new msg Starts with 0x55(85);
#X text 374 216 2nd byte defines msg-role \; 89 == Quaternion (q1 \, q2 \, q3 \, q4);
#X obj 17 26 inlet;
#X obj 56 182 route 83 89, f 47;
#X obj 56 226 send \$0-angle;
#X obj 219 226 send \$0-quaternions;
#X connect 0 0 1 1;
#X connect 0 1 1 0;
#X connect 1 0 2 0;
#X connect 1 0 7 0;
#X connect 2 0 1 1;
#X connect 6 0 0 0;
#X connect 7 0 8 0;
#X connect 7 1 9 0;
#X restore 187 459 pd build Message subpatch;
#X connect 3 0 6 0;
#X connect 4 0 3 1;
#X connect 7 0 5 0;
#X connect 9 0 20 0;
#X connect 12 0 19 0;
#X connect 13 0 19 0;
#X connect 14 0 19 0;
#X connect 15 0 17 0;
#X connect 16 0 12 0;
#X connect 17 0 13 0;
#X connect 17 1 14 0;
#X connect 18 0 21 0;
#X connect 20 0 23 0;
#X connect 20 1 24 0;
#X connect 20 2 25 0;
#X connect 21 0 3 0;
#X connect 21 0 26 0;
